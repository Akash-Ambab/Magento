<?php
$currentProduct = $block->getCurrentProduct();

$finalPrice = $currentProduct->getFinalPrice();
$dataCollection = $block->getModelData();
$onlyBankCode = $block->getOnlyBankCode();
// $block->test();

// $minEmi = [];
?>

<div id="popup-modal">
    <div id="json_out">

    </div>
    <div id="element" class="collapsibleContainer" data-mage-init='{"accordion":{"openedState": "active", "collapsible": true, "active": false, "multipleCollapsible": true}}'>
            <div class="collapsibleTab" data-role="collapsible">
                <div data-role="trigger">
                        <span>Test</span>
                </div>
            </div>
            <div class="collapsibleContent" data-role="content">
                <table id="emitable">
                    <thead>
                        <tr>
                            <th>EMI Plans</th>
                            <th>Interest(pa)</th>
                            <th>Final Amount</th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: test">
                        
                        <tr>
                            <td data-bind="text: emiplan"></td>
                            <td>Test</td>
                            <td>Test</td>
                        </tr>
                    </tbody>
                </table>
            </div>
    </div> 
</div>

<?php if($block->isEnabled()): ?>
    <p id="emiBlock">Emi Starts From</p>
<?php endif; ?>

<script>
    require(
        [
            'jquery'
        ],
        function (
            $
        ) {
            $('body').on('click', '#emiBlock', function () {
 
                // var self = $(this);
                var url = "<?php echo $block->getUrl() . 'emidetails/index/JsonData' ?>";
                // console.log(url);
                try {
 
                    $.ajax({
                        url: url,
                        type: 'POST',
                        dataType: 'json',
                        // showLoader: true,
                        success: function (data) {
                            // data = json_decode(data);
                            
                            let bankNames = data['BankNameTest'];
                            
                            // for(let i in data) {
                                //     bankName.push([i, data[i]])
                                // }
                                
                                // alert(var_dump(bankNames.HDFC));
                            let bankCodes = data['getOnlyBankCode'];
                            // $('#json_out').text(bankCodes);
                            let emiPlans = data['EMI_Plan'];

                            test = ko.applyBindings({
                                test: 
                            });
                            var ViewModel = function () {
                                this.test = ko.observableArray([
                                    { emiplan: 'Bert' },
                                    { emiplan: 'Charles' },
                                    { emiplan: 'Denise' }
                                ]); 
                                };
                                    
                                $(function () {
                                ko.applyBindings(new ViewModel());
                                });
                            // for(a of data.getOnlyBankCode) {
                            //     $('#json_out').text(a)
                            // }
                            // $('#json_out').text();
                            // alert(var_dump(JSON.stringify(data.EMI_Plan.AXIS)));
                            // // foreach(data.EMI_Plan.AXIS as a) {
                            // //     console.log(a);
                            // // }

                            // const test = JSON.parse(data);
                            // alert();
                            // foreach(test as a) {

                            // }
                        }
                    });
                } catch (e) {
                }
 
            });
        });
</script>