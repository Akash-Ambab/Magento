<?php
$currentProduct = $block->getCurrentProduct();

$finalPrice = $currentProduct->getFinalPrice();
$dataCollection = $block->getModelData();
$onlyBankCode = $block->getOnlyBankCode();

$minEmi = [];
?>

<div id="popup-modal">

    <?php if($currentProduct): ?>
        <h1><?php $finalPrice; ?></h1>
        <div id="element" class="collapsibleContainer" data-mage-init='{"accordion":{"openedState": "active", "collapsible": true, "active": false, "multipleCollapsible": true}}'>
            <?php foreach ($onlyBankCode->getData() as $bankcode): ?>
                <div class="collapsibleTab" data-role="collapsible">
                    <div data-role="trigger">
                        <?php foreach ($block->getBankName($bankcode['bank_code']) as $bankName): ?>
                            <span><?php echo $bankName['bank_name']; ?></span>
                        <?php endforeach; ?>
                    </div>
                </div>
                <div class="collapsibleContent" data-role="content">
                        <table id="emitable">
                            <thead>
                                <tr>
                                    <th>EMI Plans</th>
                                    <th>Interest(pa)</th>
                                    <th>Final Amount</th>
                                </tr>
                            </thead>
                            <tbody>

                        <?php foreach ($block->getEmiPlans($bankcode['bank_code'])->getData() as $emi): ?>
                            <?php 
                                $interestAmmount = $block->calculateEmi($finalPrice, $emi['interest'], $emi['month']);
                                $interestAmmount = ceil($interestAmmount);
                                $permonth = round($finalPrice / $emi['month'], 2);
                                array_push($minEmi, $permonth);
                            ?>
                            <tr>
                                <td><?php echo $permonth . " Rs / ". $emi['month'] . " months"; ?></td>
                                <td><?php echo ($interestAmmount * $emi['month']) - $finalPrice . " Rs (". $emi['interest']. "%)"; ?></td>
                                <td><?php echo $interestAmmount * $emi['month'] . " Rs" ?></td>
                            </tr>
                            
                        <?php endforeach; ?>
                        </tbody>
                    </table>
                </div>
            <?php endforeach; ?>
        </div>
    <?php endif; ?>    
</div>

<?php if($block->isEnabled()): ?>
    <p id="emiBlock">Emi Starts From <span><?php echo '<b>'.min($minEmi).' Rs ></b>' ?></span></p>
<?php endif; ?>